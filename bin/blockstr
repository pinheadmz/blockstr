#!/usr/bin/env node
'use strict';

const {NodeClient} = require('bclient');
const fs = require('fs');
const path = require('path');
const os = require('os');

const Art = require('../lib/art');

const file = path.join(os.homedir(), '.bitcoin', '.cookie');
const cookie = fs.readFileSync(file, 'ascii');
const [username, password] = cookie.split(':');

const hash = process.argv[2];

const clientOptions = {
  port: 8332,
  username,
  password
};

const client = new NodeClient(clientOptions);

(async () => {
  const block = await client.execute('getblock', [hash]);
  const art = new Art(block);
  art.draw();
  await art.print();
  process.stdout.write(`Art printed: ${art.filename()}\n`);
})().catch((err) => {
  console.error(err.stack);
  process.exit(1);
});
